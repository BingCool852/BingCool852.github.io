<!DOCTYPE html>
<html>    
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title>OpenStack架构学习小结</title>
  <meta name="description" content="openstack初学习小结，架构概念，一些常用命令。">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://bravelife.top/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/2016/01/10/learn-openstack.html">
  <link rel="alternate" type="application/atom+xml" title="peakcool | 个人博客" href="http://bravelife.top/feed.xml" />
  <script src="/scripts/jquery-1.11.2.min.js"></script>
  <script src="/scripts/pithy.js"></script>
</head>


  <body>
    <header class="header">
	<div class="header-container">
		<div class="nav">
			
				<li>
					<a href="/index.html">首页</a>
				</li>			
			
			
				<li>
					<a href="/archive.html">文章</a>
				</li>			
			
			
				<li>
					<a href="/category.html">分类</a>
				</li>			
			
			
				<li>
					<a href="/about.html">关于</a>
				</li>			
			
		</div>
		<div class="description"> 群山不需要齐整,参差方显气度。 </div>		
		<ul class="social-links">
			<li>
				<a href="https://github.com/jekyll" title="Github">
					<img width="19px" height="19px" src="/images/github.png"/>
				</a>
			</li>
			<li>
				<a href="/feed.xml" title="RSS">
					<img width="19px" height="19px" src="/images/rss.png"/>
				</a>
			</li>
			<li>
				<a href="https://twitter.com/jekyllrb" title="Twitter">
					<img width="19px" height="19px" src="/images/twitter.png"/>
				</a>
			</li>
		</ul>		
	</div>
</header>

    <br>
    <div class="page-content">
      <div class="wrapper">
        <div class="post">
  <br>
  <header class="post-header">
    <h1 class="post-title">OpenStack架构学习小结</h1>
    <p class="post-meta">Jan 10, 2016 • tangliangcheng</p>
  </header>

  <article class="post-content">
    <h3 id="section">1. 关于云计算</h3>

<blockquote>**_定义:_** 云计算是一种IT资源的交付和使用模式。通过网络以按需，易拓展的方式获得所需的资源（硬件，平台，软件及服务等）。提供资源的网络被称为“云”。
**_特征:_** 提供服务，可伸缩，共享，按需付费</blockquote>

<p>##</p>

<h3 id="section-1">2. 云计算系统分层体系架构</h3>

<blockquote>

&gt; 
&gt; 
	
&gt;   * 应用软件层
&gt; 
	
&gt;   * 云系统软件层
&gt; 
	
&gt;   * 云操作系统层
&gt; 
	
&gt;   * 云硬件资源
&gt; 


&gt; 
&gt; ## 
&gt; 
&gt; 
1.云硬件资源层与pc系统不同点：

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 资源不单是单台服务器的内部资源，利用网络链接
&gt;&gt; 
	
&gt;&gt;   * 资源分布在大量的服务器，存储设备上
&gt;&gt; 
	
&gt;&gt;   * 资源也可能分布在多个数据中心
&gt;&gt; 
	
&gt;&gt;   * 资源量很大，而且异构
&gt;&gt; 

</blockquote>
&gt; 
&gt; 

&gt; 
&gt; ## 
&gt; 
&gt; 
2.云操作系统：

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 资源管理功能: 向上呈现统一的，抽象的资源视图，实现统一的资源监控，资源调度和资源生命周期管理（物理资源，虚拟资源，集群管理）
&gt;&gt; 
	
&gt;&gt;   * 调度管理功能: 根据一定的调度策略和算法，为上层的各类软件，应用和任务优化分配资源，解决计算人物并行执行同步的问题
&gt;&gt; 
	
&gt;&gt;   * 文件存储功能: 通过对底层的分布式存储资源进行抽象，为上层软件，应用和任务提供对文件，对象和数据的存储能力
&gt;&gt; 

</blockquote>
&gt; 
&gt; 

&gt; 
&gt; ## 
&gt; 
&gt; 
3.云系统软件层

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 由支撑上层云应用软件执行的“部件”组成：
&gt;&gt; 


&gt;&gt; 
&gt;&gt; <blockquote>

&gt;&gt;&gt; 
&gt;&gt;&gt; 
	
&gt;&gt;&gt;   * 数据库
&gt;&gt;&gt; 
	
&gt;&gt;&gt;   * 运行环境
&gt;&gt;&gt; 
	
&gt;&gt;&gt;   * 应用框架
&gt;&gt;&gt; 
	
&gt;&gt;&gt;   * 函数库
&gt;&gt;&gt; 
	
&gt;&gt;&gt;   * ......
&gt;&gt;&gt; 

</blockquote>
&gt;&gt; 
&gt;&gt; 

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 与pc系统差别:
&gt;&gt; 


&gt;&gt; 
&gt;&gt; <blockquote>

&gt;&gt;&gt; 
&gt;&gt;&gt; 
	
&gt;&gt;&gt;   * 不同开发商同时在其上进行开发，测试和运行
&gt;&gt;&gt; 
	
&gt;&gt;&gt;   * 不同应用共享系统软件：数据库，文件系统等
&gt;&gt;&gt; 

</blockquote>
&gt;&gt; 
&gt;&gt; 
</blockquote>
&gt; 
&gt; 

&gt; 
&gt; ## 
&gt; 
&gt; 
4.云应用软件层

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 承载和运行各类用户或提供商的应用软件,应用和任务，给予paas层开发的“云应用”有：
&gt;&gt; 


&gt;&gt; 
&gt;&gt; <blockquote>

&gt;&gt;&gt; 
&gt;&gt;&gt; 
	
&gt;&gt;&gt;   * Azure
&gt;&gt;&gt; 
	
&gt;&gt;&gt;   * GAE
&gt;&gt;&gt; 

</blockquote>
&gt;&gt; 
&gt;&gt; 
</blockquote>
&gt; 
&gt; 
</blockquote>

<hr />

<h3 id="section-2">3. 云系统架构与服务体系的对应关系</h3>

<blockquote>

&gt; 
&gt; 
	
&gt;   * 云应用软件----saas
&gt; 
	
&gt;   * 云系统软件----paas
&gt; 
	
&gt;   * 云操作系统----iaas
&gt; 
	
&gt;   * 云硬件资源----云硬件资源
&gt; 

</blockquote>

<hr />

<h3 id="iaas">4. IaaS</h3>

<blockquote>**定义：** 将IT基础设施能力通过互联网提供给用户使用，并根据用户对资源的实际使用量或占有量进行计费的一种服务
**提供的服务：**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 计算即服务
&gt;&gt; 
	
&gt;&gt;   * 存储即服务
&gt;&gt; 
	
&gt;&gt;   * 网络即服务
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**关键支撑技术：**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 服务器虚拟化(2种类型：裸金属架构，寄居架构.主要内容:cpu,内存，io设备)
&gt;&gt; 
	
&gt;&gt;   * 存储虚拟化
&gt;&gt; 
	
&gt;&gt;   * 网络虚拟化
&gt;&gt; 
	
&gt;&gt;   * 云计算管理平台
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**应用场景：**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 服务提供商需要搭建和部署拥有海量资源的资源池供用户使用
&gt;&gt; 
	
&gt;&gt;   * 当获得需求后，服务提供商从资源池中选取用户所需的处理器,内存,磁盘,网络等资源，并将这些资源组织称虚拟服务器提供给用户
&gt;&gt; 
	
&gt;&gt;   * 用户看到的是一台能够痛过网络访问的服务器
&gt;&gt; 
	
&gt;&gt;   * 用户需要负责操作系统，系统软件和应用软件的部署和管理。
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
</blockquote>

<hr />

<h3 id="openstack">5.什么是OpenStack</h3>

<blockquote>

&gt; 
&gt; 
	
&gt;   * 一个可以用来建立私有云和公有云的开源软件
&gt; 
	
&gt;   * 良好的框架，具有良好的拓展性
&gt; 
	
&gt;   * 经过验证:swift支撑100pb存储
&gt; 
	
&gt;   * 虚拟化管理工具
&gt; 

</blockquote>

<hr />

<h3 id="openstack-1">6.OpenStack组件</h3>

<blockquote>

&gt; 
&gt; 
	
&gt;   * Dashboard(Horizon)：提供了对于所有openstack services的一个基于web的用户界面。**_提供管理和使用云平台的ui界面_**
&gt; 
	
&gt;   * Compute(Nova)：将最终用户的api请求发送到正在运行的虚拟机上。**_提供计算即服务_**
&gt; 
	
&gt;   * Image(Glance)：主要用来管理镜像文件，这些文件在Compute中被使用。**_提供虚拟机镜像服务_**
&gt; 
	
&gt;   * Ldentity(Keystone)：提供验证和授权的所有openstack的服务 **_提供身份验证服务_**
&gt; 
	
&gt;   * Object Store(Swift)：提供对象的存储。**_提供存储即服务_**
&gt; 
	
&gt;   * Network(Quantum）：提供基于那些同样有nova的连接来提供对用户的服务。
&gt; 
	
&gt;   * Block Storage(Cinder)：给用户的虚拟机上提供持久的块存储。
&gt; 

</blockquote>

<hr />

<h3 id="nova">7. Nova</h3>

<blockquote>**1.Nova在openstack中的作用是：**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * openstack平台的结构控制器
&gt;&gt; 
	
&gt;&gt;   * 处理所有用来支持管理虚拟机生命周期的操作
&gt;&gt; 
	
&gt;&gt;   * 管理所有的计算资源，网络，授权，以及提供云平台的可扩张性和可靠性
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**2.Nova有多个组件组成，这些组件可运行在同一服务器上，也可以单独运行在不同的服务器上。**

**3.Nova 设计特性**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 模块间不共享状态信息，即使是同类型的节点之间也是如此
&gt;&gt; 
	
&gt;&gt;   * 模块间不直接通信都是通过messaging进行
&gt;&gt; 
	
&gt;&gt;   * 异步通信
&gt;&gt; 
	
&gt;&gt;   * 与虚拟层技术无关
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**4.Nova API节点**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 是一个提供nova-api服务的服务器
&gt;&gt; 
	
&gt;&gt;   * 是外部使用和管理nova的界面
&gt;&gt; 
	
&gt;&gt;   * 是外部请求转换成内部任务分发各个模块去执行，并将结果返回给请求者
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**5.Nova API请求流程**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 提交用户名和密码给身份验证服务器
&gt;&gt; 
	
&gt;&gt;   * 返回“验证令牌“和"服务目录"
&gt;&gt; 
	
&gt;&gt;   * 提交”验证令牌“ 和请求参数到nova接入端点
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**6.Nova messaging特点（消息队列的优势）**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 服务使用端(客户端)与服务提供端(服务器端)解耦
&gt;&gt; 
	
&gt;&gt;   * 异步调用
&gt;&gt; 
	
&gt;&gt;   * 容易实现服务器端负载均衡
&gt;&gt; 
	
&gt;&gt;   * 分布式部署服务端
&gt;&gt; 
	
&gt;&gt;   * 发布－订阅模式
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
</blockquote>

<hr />

<h3 id="section-3">8.同步和异步通信</h3>

<blockquote>**同步定义:**客户端直接请求服务器端，等待服务结果返回才能继续进行

**异步定义:**客户端与服务器端并不直接通信，客户端将请求的消息的形式放在请求消息队列中，然后可以处理其它业务逻辑

**同步通信优势**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 更为简单而且更容易实现
&gt;&gt; 
	
&gt;&gt;   * 发起方在系统中等待直到对方响应，这样避免了复杂的发送／确认／重传机制
&gt;&gt; 
	
&gt;&gt;   * 实时性好
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**同步通信劣势**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 客户端因为需要同步等待而无法并发处理任务
&gt;&gt; 
	
&gt;&gt;   * 造成服务器端的系统资源长时间被占用，服务实例因为要与客户端通信而不能在任务完成时立即处理下一个任务
&gt;&gt; 
	
&gt;&gt;   * 服务实例临时不可用会造成客户端请求无法得到处理
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**异步通信优势**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 通信的达成只依赖于发送方和消息中间件，接收方以及网络的意外情况不造城影响
&gt;&gt; 
	
&gt;&gt;   * 因为不必事先同步握手，异步通信通常效率更高
&gt;&gt; 
	
&gt;&gt;   * 因为不必等待相应，异步通信倾向于实现更短的交易处理，节省系统资源占用
&gt;&gt; 
	
&gt;&gt;   * 有利于提高系统并发度，提高系统吞吐能力
&gt;&gt; 
	
&gt;&gt;   * 更有利于实现松耦合的系统结构
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**异步通信劣势**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 实现复杂
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
</blockquote>

<hr />

<h3 id="amqp">9.AMQP实现通信</h3>

<blockquote>因素：消息

实体：交换器，队列

机制：交换器与消息队列通过消息的绑定与转发机制实现消息通信</blockquote>

<hr />

<h3 id="exchange">10.消息转发中交换器(exchange)</h3>

<blockquote>exchange有三种类型:fanout,direct,tipic

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * fanout exchange：不处理路由键，速度最快，会发送到每一个队列上
&gt;&gt; 
	
&gt;&gt;   * direct exchange: 精确匹配，如routing key = cloud,那么binding key 必须也为cloud
&gt;&gt; 
	
&gt;&gt;   * topic exchange: 模糊匹配，“＊”代表一个单词，"#"代表0个或者多个单词
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
</blockquote>

<hr />

<h3 id="section-4">11.组件之间如何工作</h3>

<blockquote>交换器通过AMQP消息头(header)中的路由选择关键字(routing key)而形成的绑定规则(binding)来实现消息的转发。</blockquote>

<hr />

<h3 id="rpccall">12.消息调用应用程序rpc.call(请求与响应)</h3>

<blockquote>

&gt; 
&gt; 
	
&gt;   * 通过2次消息发送完成一次rpc
&gt; 
	
&gt;   * 任务发送者使用topic模式
&gt; 
	
&gt;   * 任务执行者使用直接模式返回执行结果
&gt; 

</blockquote>

<hr />

<h3 id="rpccast">13.rpc.cast单向请求</h3>

<blockquote>

&gt; 
&gt; 
	
&gt;   * 单向消息
&gt; 
	
&gt;   * 不需要返回任务执行结果
&gt; 
	
&gt;   * 异步传输
&gt; 

</blockquote>

<hr />

<h3 id="section-5">14.关键概念</h3>

<blockquote>

&gt; 
&gt; 
	
&gt;   * Exchange:消息交换机，指定消息按什么规则路由到哪个队列，三种类型
&gt; 
	
&gt;   * Queue：消息队列载体，每个消息都会被投入到一个或多个队列
&gt; 
	
&gt;   * Binding：绑定，将Exchange和Queue按照规则绑定起来
&gt; 
	
&gt;   * Routing Key：路由关键字
&gt; 

</blockquote>

<hr />

<h3 id="section-6">15.消息队列的工作流程</h3>

<blockquote>消息生产者创建，接受消息转发至消息队列，再存储转发交换器传来的消息到消息消费者。</blockquote>

<hr />

<h3 id="nova-scheduler">16.Nova Scheduler主要任务</h3>

<blockquote>

&gt; 
&gt; 
	
&gt;   * 决定往那里发送对Compute,Volume,Network的请求
&gt; 
	
&gt;   * Compute，Volume可以使用不同的策略
&gt; 
	
&gt;   * Network采用随机策略
&gt; 

</blockquote>

<hr />

<h3 id="fillteringweighting">17.Filltering和Weighting</h3>

<blockquote>Fillter作用：过滤哪些物理服务器可以考虑来响应请求

Weighting作用：

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 对每个过滤剩余的节点进行1/n个成本计算
&gt;&gt; 
	
&gt;&gt;   * 然后对每一项进行加权计算
&gt;&gt; 
	
&gt;&gt;   * 选择总成本最小的节点
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
Fill First（＋1.0）：

&gt; 
&gt; <blockquote>剩余内存越少，优先级越高，一个节点上尽可能多的部署虚拟机</blockquote>
&gt; 
&gt; 
Spread First （-1.0）：

&gt; 
&gt; <blockquote>主机剩余内存越多，优先级越高，尽量将虚拟机分散到尽可能多的节点</blockquote>
&gt; 
&gt; 
</blockquote>

<hr />

<h3 id="nova-network">18.Nova Network</h3>

<blockquote>**1.网络ip地址**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 每个虚拟机可以有两个ip地址，fixed ip(内部ip)，floating ip(外部ip)
&gt;&gt; 
	
&gt;&gt;   * fixed ip用来进行虚拟机之间的通信,是固定的。
&gt;&gt; 
	
&gt;&gt;   * floating ip虚拟机用来和外部的通信，可变的。
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**2.网桥bridge的作用**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 解决虚拟机网卡连接问题
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**3.安全组的作用**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 过滤进入虚拟机的网络流
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
</blockquote>

<hr />

<h3 id="nova-compute">19.Nova Compute</h3>

<blockquote>**1.nova compute主要任务**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 管理物理服务器和其上的虚拟机生命周期
&gt;&gt; 
	
&gt;&gt;   * 接受controller的命令进行相应的管理操作
&gt;&gt; 
	
&gt;&gt;   * 连接各种服务器虚拟技术的驱动模块
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
**2.虚拟机的生命周期**

&gt; 
&gt; <blockquote>

&gt;&gt; 
&gt;&gt; 
	
&gt;&gt;   * 创建create
&gt;&gt; 
	
&gt;&gt;   * 开启launch
&gt;&gt; 
	
&gt;&gt;   * 暂停pause
&gt;&gt; 
	
&gt;&gt;   * 继续continue
&gt;&gt; 
	
&gt;&gt;   * 终止terminate
&gt;&gt; 
	
&gt;&gt;   * 快照snapshot
&gt;&gt; 

</blockquote>
&gt; 
&gt; 
</blockquote>

<h3 id="glance">20.Glance</h3>

<blockquote>

&gt; 
&gt; 
	
&gt;   * glance本身不实现对镜像的存储功能
&gt; 
	
&gt;   * glance是一个代理，镜像存储服务和nova之间的纽带
&gt; 
	
&gt;   * 支持两种镜像存储格式：简单文件存储，swift服务存储镜像机制
&gt; 

</blockquote>

<h3 id="cinder">21.Cinder架构优缺点</h3>

<blockquote>

&gt; 
&gt; 
	
&gt;   * 优点：模块之间可以灵活的相互协调，架构容易扩展
&gt; 
	
&gt;   * 缺点：rabbitmq负担重
&gt; 

</blockquote>

  </article>
</div>

      </div>
    </div>
    
    <footer class="footer">
  <div id="gotop">^</div>
  <br>
	@2015 Pithy Theme by Pawpaw.
</footer>

    
  </body>

</html>
